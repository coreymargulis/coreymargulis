!function(e,t){function i(){u.removeClass("wp-dfw-show-ui")}function n(t){d.$dfwWrap.parents().each(function(i,n){var s,r=e(n);return t?(n.style.position&&r.data("wp-dfw-css-position",n.style.position),r.css("position","static")):(s=r.data("wp-dfw-css-position"),s=s||"",r.css("position",s)),"BODY"===n.nodeName?!1:void 0})}var s,r,d,o,a,l,f=0,c="transitionend webkitTransitionEnd",u=e(document.body),w=e(document);l=function(){this.topics={},this.subscribe=function(e,t){return this.topics[e]||(this.topics[e]=[]),this.topics[e].push(t),t},this.unsubscribe=function(e,t){var i,n,s=this.topics[e];if(!s)return t||[];if(t){for(i=0,n=s.length;n>i;i++)t==s[i]&&s.splice(i,1);return t}return this.topics[e]=[],s},this.publish=function(e,t){var i,n,s,r=this.topics[e];if(r){for(t=t||[],i=0,n=r.length;n>i;i++)s=r[i].apply(null,t)===!1||s;return!s}}},s={},r=s.pubsub=new l,d=s.settings={visible:!1,mode:"tinymce",id:"",title_id:"",timer:0,toolbar_shown:!1},o=s.toggleUI=function(e){clearTimeout(a),u.hasClass("wp-dfw-show-ui")&&"show"!==e?"autohide"!==e&&u.removeClass("wp-dfw-show-ui"):u.addClass("wp-dfw-show-ui"),"autohide"===e&&(a=setTimeout(i,2e3))},s.on=function(){var i,n,r;if(!d.visible){if(d.$fullscreenFader||s.ui.init(),"object"==typeof t.wp_fullscreen_settings&&e.extend(d,t.wp_fullscreen_settings),i=d.id||t.wpActiveEditor,!i){if(!d.hasTinymce)return;i=tinymce.activeEditor.id}d.id=i,n=d.$dfwWrap=e("#wp-"+i+"-wrap"),n.length&&(d.$dfwTextarea=e("#"+i),d.$editorContainer=n.find(".wp-editor-container"),f=w.scrollTop(),d.hasTinymce&&(d.editor=tinymce.get(i)),d.editor&&!d.editor.isHidden()?(d.origHeight=e("#"+i+"_ifr").height(),d.mode="tinymce"):(d.origHeight=d.$dfwTextarea.height(),d.mode="html"),r="undefined"==typeof t.adminpage||"post-php"!==t.adminpage&&"post-new-php"!==t.adminpage?i+"-title":"title",d.$dfwTitle=e("#"+r),d.$dfwTitle.length||(d.$dfwTitle=null),s.ui.fade("show","showing","shown"))}},s.off=function(){d.visible&&s.ui.fade("hide","hiding","hidden")},s.switchmode=function(e){var t=d.mode;return e&&d.visible&&d.hasTinymce&&"undefined"!=typeof switchEditors?t==e?t:("tinymce"!==e||d.editor||(d.editor=tinymce.get(d.id),!d.editor&&"undefined"!=typeof tinyMCEPreInit&&tinyMCEPreInit.mceInit&&tinyMCEPreInit.mceInit[d.id]&&(tinyMCEPreInit.mceInit[d.id].wp_fullscreen=!0)),d.mode=e,switchEditors.go(d.id,e),s.refreshButtons(!0),"html"===e&&setTimeout(s.resizeTextarea,200),e):t},s.save=function(){var i=e("#hiddenaction"),n=i.val(),s=e("#wp-fullscreen-save .spinner"),r=e("#wp-fullscreen-save .wp-fullscreen-saved-message"),o=e("#wp-fullscreen-save .wp-fullscreen-error-message");s.show(),o.hide(),r.hide(),i.val("wp-fullscreen-save-post"),d.editor&&!d.editor.isHidden()&&d.editor.save(),e.ajax({url:t.ajaxurl,type:"post",data:e("form#post").serialize(),dataType:"json"}).done(function(t){s.hide(),t&&t.success?(r.show(),setTimeout(function(){r.fadeOut(300)},3e3),t.data&&t.data.last_edited&&e("#wp-fullscreen-save input").attr("title",t.data.last_edited)):o.show()}).fail(function(){s.hide(),o.show()}),i.val(n)},s.dfwWidth=function(t,i){var n;return t&&-1!==t.toString().indexOf("%")?(d.$editorContainer.css("width",t),d.$statusbar.css("width",t),void(d.$dfwTitle&&d.$dfwTitle.css("width",t))):t?(i?n=t:(n=d.$editorContainer.width(),n+=t),void(200>n||n>1200||(d.$editorContainer.width(n),d.$statusbar.width(n),d.$dfwTitle&&d.$dfwTitle.width(n-16),setUserSetting("dfw_width",n)))):(n=e("#wp-fullscreen-body").data("theme-width")||800,d.$editorContainer.width(n),d.$statusbar.width(n),d.$dfwTitle&&d.$dfwTitle.width(n-16),void deleteUserSetting("dfw_width"))},r.subscribe("show",function(){var t=e("#last-edit").text();t&&e("#wp-fullscreen-save input").attr("title",t)}),r.subscribe("showing",function(){u.addClass("wp-fullscreen-active"),d.$dfwWrap.addClass("wp-fullscreen-wrap"),d.$dfwTitle&&(d.$dfwTitle.after('<span id="wp-fullscreen-title-placeholder">'),d.$dfwWrap.prepend(d.$dfwTitle.addClass("wp-fullscreen-title"))),s.refreshButtons(),n(!0),e("#wpadminbar").hide(),o("autohide"),s.bind_resize(),d.editor&&d.editor.execCommand("wpFullScreenOn"),"ontouchstart"in t?s.dfwWidth("90%"):s.dfwWidth(e("#wp-fullscreen-body").data("dfw-width")||800,!0),scrollTo(0,0)}),r.subscribe("shown",function(){d.visible=!0,d.editor&&!d.editor.isHidden()?d.editor.execCommand("wpAutoResize"):s.resizeTextarea("force")}),r.subscribe("hide",function(){w.unbind(".fullscreen"),d.$dfwTextarea.unbind(".wp-dfw-resize")}),r.subscribe("hiding",function(){u.removeClass("wp-fullscreen-active"),d.$dfwTitle&&e("#wp-fullscreen-title-placeholder").before(d.$dfwTitle.removeClass("wp-fullscreen-title").css("width","")).remove(),d.$dfwWrap.removeClass("wp-fullscreen-wrap"),d.$editorContainer.css("width",""),d.$dfwTextarea.add("#"+d.id+"_ifr").height(d.origHeight),d.editor&&d.editor.execCommand("wpFullScreenOff"),n(!1),t.scrollTo(0,f),e("#wpadminbar").show()}),r.subscribe("hidden",function(){d.visible=!1}),s.refreshButtons=function(t){"html"===d.mode?(e("#wp-fullscreen-mode-bar").removeClass("wp-tmce-mode").addClass("wp-html-mode").find("a").removeClass("active").filter(".wp-fullscreen-mode-html").addClass("active"),t?e("#wp-fullscreen-button-bar").fadeOut(150,function(){e(this).addClass("wp-html-mode").fadeIn(150)}):e("#wp-fullscreen-button-bar").addClass("wp-html-mode")):"tinymce"===d.mode&&(e("#wp-fullscreen-mode-bar").removeClass("wp-html-mode").addClass("wp-tmce-mode").find("a").removeClass("active").filter(".wp-fullscreen-mode-tinymce").addClass("active"),t?e("#wp-fullscreen-button-bar").fadeOut(150,function(){e(this).removeClass("wp-html-mode").fadeIn(150)}):e("#wp-fullscreen-button-bar").removeClass("wp-html-mode"))},s.ui={init:function(){var i;d.toolbar=i=e("#fullscreen-topbar"),d.$fullscreenFader=e("#fullscreen-fader"),d.$statusbar=e("#wp-fullscreen-status"),d.hasTinymce="undefined"!=typeof tinymce,d.hasTinymce||e("#wp-fullscreen-mode-bar").hide(),w.keyup(function(e){var t,i=e.keyCode||e.charCode;d.visible&&(t=navigator.platform&&-1!==navigator.platform.indexOf("Mac")?e.ctrlKey:e.altKey,!t||61!==i&&107!==i&&187!==i||(s.dfwWidth(25),e.preventDefault()),!t||45!==i&&109!==i&&189!==i||(s.dfwWidth(-25),e.preventDefault()),t&&48===i&&(s.dfwWidth(0),e.preventDefault()))}),w.on("keydown.wp-fullscreen",function(e){27===e.which&&d.visible&&(s.off(),e.stopImmediatePropagation())}),"ontouchstart"in t&&u.addClass("wp-dfw-touch"),i.on("mouseenter",function(){o("show")}).on("mouseleave",function(){o("autohide")}),e("#wp-fullscreen-buttons").on("click.wp-fullscreen","button",function(e){var i=e.currentTarget.id?e.currentTarget.id.substr(6):null;if(d.editor&&"tinymce"===d.mode)switch(i){case"bold":d.editor.execCommand("Bold");break;case"italic":d.editor.execCommand("Italic");break;case"bullist":d.editor.execCommand("InsertUnorderedList");break;case"numlist":d.editor.execCommand("InsertOrderedList");break;case"link":d.editor.execCommand("WP_Link");break;case"unlink":d.editor.execCommand("unlink");break;case"help":d.editor.execCommand("WP_Help");break;case"blockquote":d.editor.execCommand("mceBlockQuote")}else"link"===i&&t.wpLink&&t.wpLink.open();"wp-media-library"===i&&"undefined"!=typeof wp&&wp.media&&wp.media.editor&&wp.media.editor.open(d.id)})},fade:function(e,t,i){d.$fullscreenFader||s.ui.init(),(!e||r.publish(e))&&s.fade.In(d.$fullscreenFader,200,function(){t&&r.publish(t),s.fade.Out(d.$fullscreenFader,200,function(){i&&r.publish(i)})})}},s.fade={sensitivity:100,In:function(t,i,n,r){if(n=n||e.noop,i=i||400,r=r||!1,s.fade.transitions){if(t.is(":visible"))return t.addClass("fade-trigger"),t;t.show(),t.first().one(c,function(){n()}),setTimeout(function(){t.addClass("fade-trigger")},this.sensitivity)}else r&&t.stop(),t.css("opacity",1),t.first().fadeIn(i,n),t.length>1&&t.not(":first").fadeIn(i);return t},Out:function(t,i,n,r){return n=n||e.noop,i=i||400,r=r||!1,t.is(":visible")?(s.fade.transitions?(t.first().one(c,function(){t.hasClass("fade-trigger")||(t.hide(),n())}),setTimeout(function(){t.removeClass("fade-trigger")},this.sensitivity)):(r&&t.stop(),t.first().fadeOut(i,n),t.length>1&&t.not(":first").fadeOut(i)),t):t},transitions:function(){var e=document.documentElement.style;return"string"==typeof e.WebkitTransition||"string"==typeof e.MozTransition||"string"==typeof e.OTransition||"string"==typeof e.transition}()},s.bind_resize=function(){d.$dfwTextarea.on("keydown.wp-dfw-resize click.wp-dfw-resize paste.wp-dfw-resize",function(){s.resizeTextarea()})},s.resizeTextarea=function(){var e=d.$dfwTextarea[0];e.scrollHeight>e.clientHeight&&(e.style.height=e.scrollHeight+50+"px")},t.wp=t.wp||{},t.wp.editor=t.wp.editor||{},t.wp.editor.fullscreen=s}(jQuery,window);