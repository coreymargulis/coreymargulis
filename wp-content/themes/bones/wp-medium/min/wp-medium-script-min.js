!function($){$(document).ready(function(){$body=$(document.body),$window=$(window),$html=$(document.documentElement);var t={init:function(){return this.shouldBeDisabled()?!1:(this.refreshVars(),this.storeTheStateOnLoad(),this.loadNextPost(this.loadFirstNext),this.divLayout=this.next.clone(),this.divLayout.find(".inner").removeAttr("style"),void this.startTheHandlers())},shouldBeDisabled:function(){var t=!1,e=navigator.userAgent.toLowerCase();return"undefined"==typeof history.pushState||"undefined"==typeof history.replaceState||-1===e.indexOf("fire")&&-1!==e.indexOf("kindle")||-1!==e.indexOf("android")||t&&(-1!==e.indexOf("fire")||-1!==e.indexOf("mobile")||-1!==e.indexOf("android")||-1!==e.indexOf("phone")||-1!==e.indexOf("ipad"))?!0:!1},refreshVars:function(){this.current=$(".post.current"),this.next=$(".post.next"),this.linkToNext=this.next.find(".link-to-next"),this.nextCounter=0},doTheSwitch:function(){$this=this,$this.changeUrl($this.linkToNext.attr("href"),$this.linkToNext.text()),$this.loadNextPost($this.loadNext),$this.current.addClass("fade-up-out"),$this.next.removeClass("content-hidden next"),$this.next.addClass("easing-upward").find(".link-to-next").contents().unwrap();var t=$this.next.get(0).getBoundingClientRect().top-$("body").offset().top;$this.next.css({transform:"translate3d(0, -"+t+"px, 0)"}),setTimeout(function(){$this.scrollTop(),$this.next.removeClass("easing-upward"),$this.current.remove(),$this.next.css({transform:""}),$this.current=$this.next.addClass("current"),$this.next=null},400)},loadNextPost:function(t){$this=this,$.ajax({type:"POST",url:wpMediumJS.ajaxurl,data:{action:"wp_medium_get_next_post",current_url:location.href,nonce:wpMediumJS.nonce}}).done(function(e){$this.nextPost=""!==e?JSON.parse(e):null,t.call($this)})},loadFirstNext:function(){null!==this.nextPost&&(this.next.find(".content").html(this.nextPost.post_content),this.bindTheClick())},loadNext:function(){return null===$this.nextPost?void(null!==$this.next&&$this.next.remove()):(null!=$this.next&&$this.nextCounter<10&&setTimeout(function(){$this.loadNext(),$this.nextCounter++},1e3),$this.next=$this.divLayout.clone(),$this.next.find(".inner").css("background-image","url('"+$this.nextPost.attachment_url+"')"),$this.next.find(".link-to-next").text($this.nextPost.post_title).attr("href",$this.nextPost.permalink),$this.next.find(".content").html($this.nextPost.post_content),$("#wrap").append($this.next),$this.refreshVars(),void $this.bindTheClick())},scrollTop:function(){$body.add($html).scrollTop(0)},changeUrl:function(t,e){"undefined"==typeof history.pushState&&(location.href=t),history.pushState({url:t},"",t),document.title=document.title.replace(this.current.find(".inner-title").text().trim(),e)},storeTheStateOnLoad:function(){"undefined"!=typeof history.replaceState&&history.replaceState({url:document.URL},null,null)},startTheHandlers:function(){window.onpopstate=this.onHistoryChange},bindTheClick:function(){var t="ontouchstart"in window?"touchstart":"click";this.linkToNext.on(t,this.onNextClick)},onNextClick:function(e){e.preventDefault(),$(this).unbind(e),t.doTheSwitch()},onHistoryChange:function(t){t&&t.state&&(location.href=t.state.url,location.reload())}};t.init()})}(jQuery);